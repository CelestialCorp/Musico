<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>More Music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        #seek-bar {
            opacity: 0.7;
        }
        #seek-bar:hover {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-800 text-white">
<div class="container mx-auto p-4 pb-24">
    <header class="bg-gray-700 p-4 rounded-lg mb-8">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-music text-3xl"></i>
                <h1 class="text-3xl font-bold">More Music</h1>
            </div>
            <a class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm" href="index.html">Back</a>
        </div>
    </header>
    <section class="mb-8">
        <h2 class="text-2xl font-bold mb-4">All Tracks</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="all-tracks-list"></div>
    </section>
</div>
<footer class="fixed bottom-0 left-0 right-0 bg-gray-900 p-4">
    <div class="container mx-auto flex flex-col md:flex-row items-center">
        <div class="flex items-center mb-4 md:mb-0">
            <img alt="Thumbnail of the currently playing track" class="w-12 h-12 object-cover rounded-lg mr-4" height="50" id="current-track-thumbnail" src="https://storage.googleapis.com/a1aa/image/PfdxZdNMzhkiGrTD-gT85IdV03X4eiGlzivCSioiHWE.jpg" width="50"/>
            <div>
                <h3 class="text-xl font-bold" id="current-track-title">Currently Playing Track</h3>
                <p class="text-gray-400" id="current-track-artist">Artist Name</p>
            </div>
        </div>
        <div class="flex items-center justify-center space-x-4 flex-grow mb-4 md:mb-0">
            <button class="text-gray-400 hover:text-white" id="prev-button">
                <i class="fas fa-backward"></i>
            </button>
            <button class="text-gray-400 hover:text-white" id="play-pause-button">
                <i class="fas fa-play"></i>
            </button>
            <button class="text-gray-400 hover:text-white" id="next-button">
                <i class="fas fa-forward"></i>
            </button>
        </div>
        <div class="flex items-center space-x-2 w-full max-w-xs">
            <span class="text-gray-400" id="current-time">0:00</span>
            <input class="w-full h-1 bg-gray-600 rounded-lg" id="seek-bar" max="100" min="0" type="range" value="0"/>
            <span class="text-gray-400" id="duration">3:45</span>
        </div>
    </div>
</footer>
<audio id="audio-player">
    <source id="audio-source" src=""/>
</audio>
<script>
    const audioPlayer = document.getElementById('audio-player');
    const audioSource = document.getElementById('audio-source');
    const playPauseButton = document.getElementById('play-pause-button');
    const currentTrackTitle = document.getElementById('current-track-title');
    const currentTrackArtist = document.getElementById('current-track-artist');
    const currentTrackThumbnail = document.getElementById('current-track-thumbnail');
    const seekBar = document.getElementById('seek-bar');
    const currentTime = document.getElementById('current-time');
    const duration = document.getElementById('duration');

    let isPlaying = false;
    let currentTrackIndex = 0;
    let tracks = [];

    async function loadTracks() {
        try {
            const response = await fetch('tracks.json');
            tracks = await response.json();
            displayTracks();
        } catch (error) {
            console.error("Error loading tracks:", error);
        }
    }

    function displayTracks() {
        const allTracksList = document.getElementById('all-tracks-list');

        allTracksList.innerHTML = ''; // Clear previous content

        tracks.forEach((track, index) => {
            const trackDiv = document.createElement('div');
            trackDiv.className = 'bg-gray-600 p-4 rounded-lg flex items-center justify-between';
            trackDiv.innerHTML = `
                <div class="flex items-center">
                    <img alt="Thumbnail of ${track.title}" class="w-12 h-12 object-cover rounded-lg mr-4" height="50" src="${track.thumbnail}" width="50"/>
                    <div>
                        <h3 class="text-xl font-bold">${track.title}</h3>
                        <p class="text-gray-400">${track.artist}</p>
                    </div>
                </div>
                <button class="text-gray-400 hover:text-white play-button" data-track="${index}">
                    <i class="fas fa-play"></i>
                </button>
            `;
            allTracksList.appendChild(trackDiv);
        });

        const playButtons = document.querySelectorAll('.play-button');
        playButtons.forEach((button) => {
            button.addEventListener('click', (event) => {
                const index = parseInt(event.target.closest('button').dataset.track);
                currentTrackIndex = index;
                loadTrack(currentTrackIndex);
            });
        });
    }

    function loadTrack(index) {
        if (isPlaying) {
            audioPlayer.pause();
            isPlaying = false;
            playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
        }

        const track = tracks[index];
        audioSource.src = track.src;
        currentTrackTitle.textContent = track.title;
        currentTrackArtist.textContent = track.artist;
        currentTrackThumbnail.src = track.thumbnail;
        audioPlayer.load();
        updateDuration();
        playPauseTrack();
    }

    function playPauseTrack() {
        if (isPlaying) {
            audioPlayer.pause();
            playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
        } else {
            audioPlayer.play().catch(error => {
                console.error("Error playing audio:", error);
            });
            playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
        }
        isPlaying = !isPlaying;
    }

    function updateSeekBar() {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        seekBar.value = progress;
        currentTime.textContent = formatTime(audioPlayer.currentTime);
    }

    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function updateDuration() {
        duration.textContent = formatTime(audioPlayer.duration);
    }

    function nextTrack() {
        currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
        loadTrack(currentTrackIndex);
    }

    function prevTrack() {
        currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
        loadTrack(currentTrackIndex);
    }

    function saveAudioState() {
        localStorage.setItem('currentTrackIndex', currentTrackIndex);
        localStorage.setItem('currentTime', audioPlayer.currentTime);
        localStorage.setItem('isPlaying', isPlaying);
    }

    function restoreAudioState() {
        const savedTrackIndex = localStorage.getItem('currentTrackIndex');
        const savedTime = localStorage.getItem('currentTime');
        const savedIsPlaying = localStorage.getItem('isPlaying');

        if (savedTrackIndex !== null) {
            currentTrackIndex = parseInt(savedTrackIndex);
            loadTrack(currentTrackIndex);
            if (savedTime !== null) {
                audioPlayer.currentTime = parseFloat(savedTime);
            }
            if (savedIsPlaying === 'true') {
                isPlaying = true;
                audioPlayer.play();
                playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
            }
        }
    }

    window.addEventListener('beforeunload', saveAudioState);
    window.addEventListener('load', restoreAudioState);

    playPauseButton.addEventListener('click', playPauseTrack);
    document.getElementById('next-button').addEventListener('click', nextTrack);
    document.getElementById('prev-button').addEventListener('click', prevTrack);
    audioPlayer.addEventListener('timeupdate', updateSeekBar);
    audioPlayer.addEventListener('loadedmetadata', updateDuration);
    audioPlayer.addEventListener('ended', nextTrack); // Aggiunto per riprodurre la prossima canzone
    seekBar.addEventListener('input', () => {
        audioPlayer.currentTime = (seekBar.value / 100) * audioPlayer.duration;
    });

    loadTracks();
</script>
</body>
</html>
